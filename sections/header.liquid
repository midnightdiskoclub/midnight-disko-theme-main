{{ 'component-list-menu.css' | asset_url | stylesheet_tag: preload: true }}
{{ 'component-search.css' | asset_url | stylesheet_tag: preload: true }}
{{ 'component-menu-drawer.css' | asset_url | stylesheet_tag: preload: true }}
{{ 'component-cart-notification.css' | asset_url | stylesheet_tag: preload: true }}

{%- style -%}
/* ===== Midnight Disko Club Header ===== */
:root {
  --hdr-bg: rgba(8,8,12,0.0);          /* transparent on hero */
  --hdr-bg-solid: rgba(8,8,12,0.88);   /* solid on scroll/not-home */
  --hdr-border: rgba(255,255,255,0.08);
  --hdr-blur: saturate(140%) blur(10px);
}

/* Base header shell */
.site-header {
  position: sticky;
  top: 0;
  z-index: 50;
  width: 100%;
  transition: background-color .25s ease, backdrop-filter .25s ease, border-color .25s ease;
  border-bottom: 1px solid transparent;
}

/* Transparent mode */
.site-header--transparent {
  background: var(--hdr-bg);
  backdrop-filter: var(--hdr-blur);
  border-bottom-color: transparent;
}

/* Solid mode (scrolled or not-home) */
.site-header--solid,
.site-header.is-scrolled {
  background: var(--hdr-bg-solid);
  border-bottom-color: var(--hdr-border);
}

/* Header inner layout */
.site-header__inner {
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  align-items: center;
  gap: .75rem;
  padding: .65rem 1rem;
}

@media (min-width: 990px){
  .site-header__inner { padding: .75rem 1.25rem; }
}

/* Left: primary nav (desktop) */
.header-nav {
  display: none;
}
@media (min-width: 990px){
  .header-nav { display: flex; gap: 1.25rem; align-items: center; }
  .header-nav a {
    color: var(--color-foreground, #fff);
    text-decoration: none;
    font-weight: 600;
    letter-spacing: .02em;
    opacity: .95;
  }
  .header-nav a:hover { opacity: 1; text-decoration: underline; text-underline-offset: 4px; }
}

/* Center: logo */
.header-logo {
  justify-self: center;
}
.header-logo img {
  display: block;
  height: auto;
  width: auto;
  max-height: 48px;
  max-width: {{ section.settings.logo_max_width | default: 180 }}px;
  filter: drop-shadow(0 0 18px rgba(158,119,255,.6));
}

/* Right: actions */
.header-actions {
  display: flex; justify-self: end; align-items: center; gap: .75rem;
}

.header-icon {
  display:inline-flex; align-items:center; justify-content:center;
  width: 40px; height: 40px; border-radius: 999px;
  border: 1px solid rgba(255,255,255,.08);
  background: rgba(255,255,255,.02);
  transition: transform .15s ease, background .2s ease;
}
.header-icon:hover { transform: translateY(-1px); background: rgba(255,255,255,.06); }

.header-count {
  min-width: 18px; height: 18px; border-radius: 999px;
  display:inline-flex; align-items:center; justify-content:center;
  font-size: 11px; font-weight: 700; margin-left: -8px; margin-top: -10px;
  background: #fff; color: #0a0a0f; padding: 0 5px; border: 1px solid #0002;
}

/* Invert (light-on-dark) links when header is transparent over dark hero */
:root {}
.header-invert .header-nav a,
.header-invert .header-icon { color: #fff; }
.header-invert .header-logo img.logo-light { display: block; }
.header-invert .header-logo img.logo-dark { display: none; }

/* When solid (scrolled), switch to dark logo (if provided) */
.site-header--solid .header-logo img.logo-light,
.is-scrolled .header-logo img.logo-light { display:none; }
.site-header--solid .header-logo img.logo-dark,
.is-scrolled .header-logo img.logo-dark { display:block; }

/* Fallback when only one logo provided */
.header-logo img:not(.logo-light):not(.logo-dark) { display:block; }

/* Mobile */
.header-mobile {
  display:flex; align-items:center; gap:.5rem;
}
@media (min-width: 990px){ .header-mobile { display:none; } }
{%- endstyle -%}

<header
  class="site-header
    {% if request.page_type == 'index' and section.settings.transparent_home %}site-header--transparent header-invert{% else %}site-header--solid{% endif %}"
  data-transparent="{{ section.settings.transparent_home and request.page_type == 'index' }}"
>
  <div class="site-header__inner page-width">
    <!-- Left: Nav (Desktop) + Mobile Drawer Button -->
    <div class="header-left">
      <div class="header-mobile">
        <header-drawer>
          <details>
            <summary class="header-icon" aria-label="{{ 'sections.header.menu' | t }}">
              {% render 'icon-hamburger' %}
            </summary>
            <div class="menu-drawer">
              {% render 'menu-drawer', menu: section.settings.menu %}
            </div>
          </details>
        </header-drawer>
      </div>
      <nav class="header-nav" role="navigation" aria-label="main">
        {% if section.settings.menu != blank %}
          <ul class="list-unstyled" role="list">
            {% for link in section.settings.menu.links %}
              <li><a href="{{ link.url }}">{{ link.title }}</a></li>
            {% endfor %}
          </ul>
        {% endif %}
      </nav>
    </div>

    <!-- Center: Logo -->
    <div class="header-logo">
      {% if section.settings.logo_light != blank or section.settings.logo_dark != blank %}
        {% if section.settings.logo_light != blank %}
          <img class="logo-light" src="{{ section.settings.logo_light | image_url: width: 500 }}" alt="{{ shop.name | escape }}">
        {% endif %}
        {% if section.settings.logo_dark != blank %}
          <img class="logo-dark" src="{{ section.settings.logo_dark | image_url: width: 500 }}" alt="{{ shop.name | escape }}">
        {% endif %}
      {% else %}
        {% if section.settings.logo != blank %}
          <img src="{{ section.settings.logo | image_url: width: 500 }}" alt="{{ shop.name | escape }}">
        {% else %}
          <span class="h2">{{ shop.name }}</span>
        {% endif %}
      {% endif %}
    </div>

    <!-- Right: Actions -->
    <div class="header-actions">
      {% if section.settings.enable_search %}
        <a class="header-icon" href="{{ routes.search_url }}" aria-label="{{ 'general.search.search' | t }}">
          {% render 'icon-search' %}
        </a>
      {% endif %}
      <a class="header-icon" href="{{ routes.cart_url }}" aria-label="{{ 'sections.header.cart' | t }}">
        {% render 'icon-cart' %}
      </a>
      {% if cart != empty %}
        <span class="header-count">{{ cart.item_count }}</span>
      {% endif %}
    </div>
  </div>
</header>

{%- javascript -%}
/* Toggle solid header on scroll if transparent on home */
(() => {
  const hdr = document.querySelector('.site-header');
  if (!hdr) return;
  const transparent = hdr.dataset.transparent === 'true';

  const apply = () => {
    const scrolled = window.scrollY > ({{ section.settings.scroll_threshold | default: 60 }});
    if (transparent) {
      hdr.classList.toggle('is-scrolled', scrolled);
    }
  };
  apply();
  document.addEventListener('scroll', apply, { passive: true });
})();
{%- endjavascript -%}

{% schema %}
{
  "name": "Header (Midnight Disko)",
  "tag": "section",
  "class": "section-header",
  "settings": [
    {
      "type": "checkbox",
      "id": "transparent_home",
      "default": true,
      "label": "Transparent on homepage (over hero)"
    },
    {
      "type": "range",
      "id": "scroll_threshold",
      "label": "Scroll threshold to solidify",
      "min": 20, "max": 150, "step": 5, "default": 80
    },
    {
      "type": "image_picker",
      "id": "logo_light",
      "label": "Logo (light / neon for dark hero)"
    },
    {
      "type": "image_picker",
      "id": "logo_dark",
      "label": "Logo (dark version for solid header)"
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Fallback logo (if above not used)"
    },
    {
      "type": "range",
      "id": "logo_max_width",
      "label": "Logo max width (px)",
      "min": 80, "max": 320, "step": 5, "default": 180
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Main menu"
    },
    {
      "type": "checkbox",
      "id": "enable_search",
      "default": true,
      "label": "Show search icon"
    }
  ],
  "blocks": [],
  "presets": [
    { "name": "Header (Midnight Disko)" }
  ]
}
{% endschema %}
