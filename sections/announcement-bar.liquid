{% comment %}
  Midnight Disko Club — Global Announcement Bar
  - Rotates up to 3 messages (optional)
  - Optional link per message
  - Dismissible (localStorage)
  - Theme color controls
{% endcomment %}

{% if section.settings.enable_bar %}
  <div
    id="mdc-announcement"
    class="mdc-announcement{% if section.settings.full_width %} mdc-announcement--full{% endif %}{% if section.settings.uppercase %} mdc-announcement--caps{% endif %}"
    style="--mdc-bar-bg: {{ section.settings.bg_color }}; --mdc-bar-fg: {{ section.settings.text_color }};"
    data-rotate="{{ section.settings.rotate_messages }}"
    data-interval="{{ section.settings.rotate_interval | times: 1000 }}"
  >
    <button class="mdc-announcement__close" aria-label="Close announcement" title="Close">
      ✕
    </button>

    <div class="mdc-announcement__track">
      {% assign items = (1..3) %}
      {% for i in items %}
        {% assign text = section.settings["msg_" | append: i ] %}
        {% assign url  = section.settings["url_" | append: i ] %}
        {% if text != blank %}
          <div class="mdc-announcement__item">
            {% if url != blank %}
              <a href="{{ url }}" {% if section.settings.open_new_tab %}target="_blank" rel="noopener noreferrer"{% endif %} class="mdc-announcement__link">
                {{ text }}
              </a>
            {% else %}
              <span class="mdc-announcement__text">{{ text }}</span>
            {% endif %}
          </div>
        {% endif %}
      {% endfor %}
    </div>
  </div>
{% endif %}

{% schema %}
{
  "name": "Midnight Announcement Bar",
  "settings": [
    { "type": "checkbox", "id": "enable_bar", "label": "Enable bar", "default": true },
    { "type": "checkbox", "id": "full_width", "label": "Edge-to-edge width", "default": true },
    { "type": "checkbox", "id": "uppercase", "label": "Uppercase text", "default": false },

    { "type": "color", "id": "bg_color", "label": "Background", "default": "#0F0A1F" },
    { "type": "color", "id": "text_color", "label": "Text", "default": "#FFFFFF" },

    { "type": "checkbox", "id": "rotate_messages", "label": "Rotate messages", "default": true },
    { "type": "range", "id": "rotate_interval", "min": 2, "max": 12, "step": 1, "unit": "s", "label": "Rotation interval", "default": 6 },

    { "type": "text", "id": "msg_1", "label": "Message 1", "default": "Join the club with no address → Discord" },
    { "type": "url",  "id": "url_1", "label": "Link 1" },

    { "type": "text", "id": "msg_2", "label": "Message 2", "default": "New Midnight Mix playlist — listen now" },
    { "type": "url",  "id": "url_2", "label": "Link 2" },

    { "type": "text", "id": "msg_3", "label": "Message 3", "default": "First Dance: Austin launch — RSVP" },
    { "type": "url",  "id": "url_3", "label": "Link 3" },

    { "type": "checkbox", "id": "open_new_tab", "label": "Open links in new tab", "default": true }
  ],
  "presets": [{ "name": "Midnight Announcement Bar" }]
}
{% endschema %}
